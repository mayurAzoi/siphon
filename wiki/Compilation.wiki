#summary Compilation guide.
#labels Phase-Implementation

= Introduction =

This article describes the steps to generate Siphon.

=PjSIP Compilation=

==Check out code==
Get [http://pjsip.org PjSIP] from subversion repository:

{{{
svn checkout http://svn.pjsip.org/repos/pjproject/trunk pjproject
}}}

==Media device for ipod==

===pjMedia===
Download [http://siphon.googlecode.com/files/ipodsound.c ipodsound.c], and save in _pjmedia/src/pjmedia_ directory.

Complete _config.h_ file in pjmedia/include/pjmedia at line 59 with:
{{{
/** Constant for AudioQueue sound backend. */
#define PJMEDIA_SOUND_IPOD_SOUND	    3
}}}

===Configuration===
Complete _aconfigure.ac_ file at line 370 with:
{{{
  arm-apple-darwin*)
	LIBS="$LIBS -framework CoreAudio -framework CoreFoundation -framework AudioToolbox"
	ac_pjmedia_snd=ipod
	AC_MSG_RESULT([Checking sound device backend... AudioQueue])
	;;
}}}

Generate configuration script
{{{
autoconf aconfigure.ac > aconfigure
}}}

Complete _os-auto.mak.in_ at line 92 with following lines:
{{{
#
# iPod/iPhone
#
ifeq ($(AC_PJMEDIA_SND),ipod)
export SOUND_OBJS = ipodsound.o
INCLUDE_IPHONE=/path/of/iphone/sdk
export CFLAGS += -DPJMEDIA_SOUND_IMPLEMENTATION=PJMEDIA_SOUND_IPOD_SOUND \
	-D__COREAUDIO_USE_FLAT_INCLUDES__ \
	-I$(INCLUDE_IPHONE)/AudioToolbox \
	-I$(INCLUDE_IPHONE)/CoreAudio \
	-I$(INCLUDE_IPHONE)/CarbonCore \
	-I$(INCLUDE_IPHONE)/CoreFoundation
endif
}}}
On Linux and Windows,you need use FLAT_INCLUDES, so you must define INCLUDE_IPHONE. This value defines the path of include directory of your iphone sdk.

Maybe, you don't need FLAT_INCLUDES on MacOS X.


==Compilation==

Configure pjsip without codec except G711 and GSM:
{{{
./aconfigure --host=arm-apple-darwin8 \
  --disable-speex-aec --disable-speex-codec \
  --disable-l16-codec --disable-g722-codec  --disable-ilbc-codec
}}}


_We need to add GSM codec, because when the pjmedia-codec library is build, the *ar* command needs object file to exit without failure._

Compile the libraries:
{{{
make
}}}

_If you get an error with AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER macro, you should update the AvailabilityMacros.h file in your sdk._